{% load i18n %}

<fieldset class="module {{ formset.classes }}">
  {{ formset.management_form }}
  <h3>{{ formset.opts.verbose_name_plural|capfirst }}</h3>
  {% if formset.errors %}
    <p class="errornote">
    {% if formset.total_error_count == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %}
    </p>
    {{ formset.non_form_errors }}
  {% endif %}
  <table class="{% block tableclasses %}{% endblock %}" {% block tableattrs %}{% endblock %}>
    <thead>
      <tr>
        <th class="original"></th>
        <th class="original">{{ formset.opts.verbose_name | title }}</th>
        {% block headers %}
        {% for field in formset.fields %}
          {% if not field.widget.is_hidden %}
            <th{% if field.required %} class="required"{% endif %}>{{ field.label|capfirst }}
            {% if field.help_text %}{{ field.help_text }}{% endif %}
            </th>
          {% endif %}
        {% endfor %}
        {% endblock %}

        {% block headers-actions %}
        <th>
          {% if not view.edit and formset.opts.has_add_permission %}
          <a href="{{ formset.opts.controller.get_add_url }}">{% trans ' Add New ' %}{{ formset.opts.verbose_name|title }}</a>
          {% endif %}
        </th>
        {% endblock %}
      </tr>
    </thead>

    <tbody>
    {% for formset_form in formset %}
      {% if formset_form.non_field_errors %}
      <tr><td colspan="{{ formset_form|cell_count }}">{{ formset_form.non_field_errors }}</td></tr>
      {% endif %}
      <tr class="{% if forloop.last %}empty-form{% endif %} {% block rowclasses %}{% endblock %}"
           id="{{ formset.prefix }}-{% if not forloop.last %}{{ forloop.counter0 }}{% else %}empty{% endif %}" {% block rowattrs %}{% endblock %}>

        {% block columns-original %}
        <td class="original">
          {% if formset_form.needs_explicit_pk_field %}{{ formset_form.pk_field }}{% endif %}
          {{ formset_form.fk_field }}
          {% spaceless %}
          {% for field in formset_form %}
            {% if field.is_hidden %} {{ field }} {% endif %}
          {% endfor %}
          {% endspaceless %}
        </td>
        <td>{% block object-link %}{% if formset_form.original and not formset_form.view.edit %}<a href="{{ formset_form.original.get_view_url }}">{{ formset_form.original }}</a>{% endif %}{% endblock %}</td>
        {% endblock %}

        {% block columns %}
        {% for field in formset_form %}
          {% block field %}
          {% if not field.is_hidden %}
            <td{% if field.name %} class="field-{{ field.name }}"{% endif %}>
              {% include 'includes/field.html' %}
            </td>
            {% endif %}
          {% endblock field %}
        {% endfor %}
        {% endblock %}

        {% block column-actions %}
        <td class="text-right">
          {% if formset.opts.has_edit_permission %}
            <a href="{{ formset_form.original.get_edit_url }}" class="btn btn-xs btn-primary"><i class="fa fa-edit fa-fw"></i></a>&nbsp;
          {% endif %}
          {% if formset.opts.has_delete_permission %}
            <a href="{{ formset_form.original.get_delete_url }}" class="btn btn-xs btn-danger"><i class="fa fa-trash fa-fw"></i></a>
          {% endif %}
        </td>
        {% endblock %}

      </tr>
    {% endfor %}
    </tbody>
  </table>
</fieldset>
